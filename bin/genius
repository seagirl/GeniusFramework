#!/bin/sh

name='application';
package='application'
output='./'

# オプションをハンドリング
while getopts n:p:o:h opt
do
	case $opt in
	n )    name=$OPTARG
	       ;;
	p )    package=$OPTARG
	       ;;
	o )    output=$OPTARG
	       ;;
	h )    echo '使用方法: genius [<オプション>]
バージョン 1.0.1
    	
利用可能なオプション:
    -n プロジェクトの名前（デフォルトは"application"です。）
    -p パッケージ（デフォルトは"application"です。）
    -o 出力先（デフォルトは"./"です。）
    	
Genius FrameworkはFlex用のフレームワークです。
さらに詳しい情報は、http://seagirl.jp/genius/をご覧ください。'
		   exit
		   ;;
    ? )    echo 'Usage -h'
		   exit
		   ;;
	esac
done

# アウトプットディレクトリ
output=${output%*/}/

# スクリプトのあるディレクトリ
path=${0%/*}

# テンプレートファイルのあるディレクトリ
template=${path}/../app-template

# 出力先の調整
package_path=${package//./\/}

# -------------------------------------------------------------------

cp -r $template $output$name
cd $output$name
find . -name '.svn' -type d -exec rm -rf {} \; 2>/dev/null
mkdir -p src/${package_path}
mv src/genius/* src/${package_path}
rm -rf src/genius

sed -e "s/\[% name %]/$name/g" src/main.mxml |
sed -e "s/\[% package %]/$package/g" > genius-tmp
mv genius-tmp src/main.mxml
echo created ${output}${name}/src/main.mxml

sed -e "s/\[% name %\]/$name/g" src/${package_path}/core/Application.as |
sed -e "s/\[% package %\]/$package/g" > genius-tmp
mv genius-tmp src/${package_path}/core/Application.as
echo created ${output}${name}/src/${package_path}/core/Application.as

sed -e "s/\[% name %\]/$name/g" src/${package_path}/threads/ChangeStateThread.as |
sed -e "s/\[% package %\]/$package/g" > genius-tmp
mv genius-tmp src/${package_path}/threads/ChangeStateThread.as
echo created ${output}${name}/src/${package_path}/threads/ChangeStateThread.as

sed -e "s/\[% name %\]/$name/g" src/${package_path}/views/MainBase.as |
sed -e "s/\[% package %\]/$package/g" > genius-tmp
mv genius-tmp src/${package_path}/views/MainBase.as
echo created ${output}${name}/src/${package_path}/views/MainBase.as

sed -e "s/\[% name %\]/$name/g" src/${package_path}/views/Main.mxml |
sed -e "s/\[% package %\]/$package/g" > genius-tmp
mv genius-tmp src/${package_path}/views/Main.mxml
echo created ${output}${name}/src/${package_path}/views/Main.mxml

sed -e "s/\[% name %\]/$name/g" src/${package_path}/views/IntroBase.as |
sed -e "s/\[% package %\]/$package/g" > genius-tmp
mv genius-tmp src/${package_path}/views/IntroBase.as
echo created ${output}${name}/src/${package_path}/views/IntroBase.as

sed -e "s/\[% name %\]/$name/g" src/${package_path}/views/Intro.mxml |
sed -e "s/\[% package %\]/$package/g" > genius-tmp
mv genius-tmp src/${package_path}/views/Intro.mxml
echo created ${output}${name}/src/${package_path}/views/Intro.mxml


echo done.

exit