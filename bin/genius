#!/bin/sh

name='MyApp';
package='application'
output='./'

# オプションをハンドリング
while getopts n:p:o:h opt
do
	case $opt in
	n )    name=$OPTARG
	       ;;
	p )    package=$OPTARG
	       ;;
	o )    output=$OPTARG
	       ;;
	h )    echo '使用方法: genius [<オプション>]
バージョン 1.0.1
    	
利用可能なオプション:
    -n プロジェクトの名前（デフォルトは"MyApp"です。）
    -p パッケージ（デフォルトは"application"です。）
    -o 出力先（デフォルトは"./"です。）
    	
Genius FrameworkはFlex用のフレームワークです。
さらに詳しい情報は、http://seagirl.jp/genius/をご覧ください。'
		   exit
		   ;;
    ? )    echo 'Usage -h'
		   exit
		   ;;
	esac
done

# アウトプットディレクトリ
output=${output%*/}/

# スクリプトのあるディレクトリ
path=${0%/*}

# テンプレートファイルのあるディレクトリ
template=${path}/../app-template

# 出力先の調整
package_path=${package//./\/}

# -------------------------------------------------------------------

cp -r $template $output$name
cd $output$name
find . -name '.svn' -type d -exec rm -rf {} \; 2>/dev/null

# script
sed -e "s/\[% name %]/$name/g" script/build |
sed -e "s/\[% package %]/$package/g" > genius-tmp
rm script/build
mv genius-tmp script/build
chmod 755 script/build
echo created ${output}${name}/script/build

sed -e "s/\[% name %]/$name/g" script/build_test |
sed -e "s/\[% package %]/$package/g" > genius-tmp
rm script/build_test
mv genius-tmp script/build_test
chmod 755 script/build_test
echo created ${output}${name}/script/build_test

# bin-debug
sed -e "s/\[% name %]/$name/g" bin-debug/main.html |
sed -e "s/\[% package %]/$package/g" > genius-tmp
rm bin-debug/main.html
mv genius-tmp bin-debug/index.html
echo created ${output}${name}/bin-debug/index.html

sed -e "s/\[% name %]/$name/g" tests/bin-debug/main.html |
sed -e "s/\[% package %]/$package/g" > genius-tmp
rm tests/bin-debug/main.html
mv genius-tmp tests/bin-debug/index.html
echo created ${output}${name}/tests/bin-debug/index.html

# tests
mkdir -p tests/src/${package_path}
mv tests/src/genius/* tests/src/${package_path}
rm -rf tests/src/genius

sed -e "s/\[% name %]/$name/g" tests/src/MyAppTest.as |
sed -e "s/\[% package %]/$package/g" > genius-tmp
rm tests/src/MyAppTest.as
mv genius-tmp tests/src/${name}Test.as
echo created ${output}${name}/tests/src/${name}Test.as

sed -e "s/\[% name %]/$name/g" tests/src/MyAppTest-config.xml |
sed -e "s/\[% package %]/$package/g" > genius-tmp
rm tests/src/MyAppTest-config.xml
mv genius-tmp tests/src/${name}Test-config.xml
echo created ${output}${name}/tests/src/${name}Test-config.xml

sed -e "s/\[% name %]/$name/g" tests/src/AllTests.as |
sed -e "s/\[% package %]/$package/g" > genius-tmp
mv genius-tmp tests/src/AllTests.as
echo created ${output}${name}/tests/src/AllTests.as

sed -e "s/\[% name %\]/$name/g" tests/src/${package_path}/MyAppAllTests.as |
sed -e "s/\[% package %\]/$package/g" > genius-tmp
rm tests/src/${package_path}/MyAppAllTests.as
mv genius-tmp tests/src/${package_path}/${name}AllTests.as
echo created ${output}${name}/tests/src/${package_path}/${name}AllTests.as

# src
mkdir -p src/${package_path}
mv src/genius/* src/${package_path}
rm -rf src/genius

sed -e "s/\[% name %]/$name/g" src/main.mxml |
sed -e "s/\[% package %]/$package/g" > genius-tmp
rm src/main.mxml
mv genius-tmp src/${name}.mxml
echo created ${output}${name}/src/${name}.mxml

sed -e "s/\[% name %]/$name/g" src/mainDelegate.as |
sed -e "s/\[% package %]/$package/g" > genius-tmp
rm src/mainDelegate.as
mv genius-tmp src/${name}Delegate.as
echo created ${output}${name}/src/${name}Delegate.as

sed -e "s/\[% name %]/$name/g" src/main.css |
sed -e "s/\[% package %]/$package/g" > genius-tmp
rm src/main.css
mv genius-tmp src/${name}.css
echo created ${output}${name}/src/${name}.css

sed -e "s/\[% name %]/$name/g" src/main-config.xml |
sed -e "s/\[% package %]/$package/g" > genius-tmp
rm src/main-config.xml
mv genius-tmp src/${name}-config.xml
echo created ${output}${name}/src/${name}-config.xml

sed -e "s/\[% name %]/$name/g" src/Config.as |
sed -e "s/\[% package %]/$package/g" > genius-tmp
mv genius-tmp src/Config.as
echo created ${output}${name}/src/Config.as

sed -e "s/\[% name %\]/$name/g" src/${package_path}/threads/ChangeStateThread.as |
sed -e "s/\[% package %\]/$package/g" > genius-tmp
mv genius-tmp src/${package_path}/threads/ChangeStateThread.as
echo created ${output}${name}/src/${package_path}/threads/ChangeStateThread.as

sed -e "s/\[% name %\]/$name/g" src/${package_path}/controllers/MainController.as |
sed -e "s/\[% package %\]/$package/g" > genius-tmp
mv genius-tmp src/${package_path}/controllers/MainController.as
echo created ${output}${name}/src/${package_path}/controllers/MainController.as

sed -e "s/\[% name %\]/$name/g" src/${package_path}/views/Main.mxml |
sed -e "s/\[% package %\]/$package/g" > genius-tmp
mv genius-tmp src/${package_path}/views/Main.mxml
echo created ${output}${name}/src/${package_path}/views/Main.mxml

sed -e "s/\[% name %\]/$name/g" src/${package_path}/controllers/Page1Controller.as |
sed -e "s/\[% package %\]/$package/g" > genius-tmp
mv genius-tmp src/${package_path}/controllers/Page1Controller.as
echo created ${output}${name}/src/${package_path}/controllers/Page1Controller.as

sed -e "s/\[% name %\]/$name/g" src/${package_path}/views/Page1.mxml |
sed -e "s/\[% package %\]/$package/g" > genius-tmp
mv genius-tmp src/${package_path}/views/Page1.mxml
echo created ${output}${name}/src/${package_path}/views/Page1.mxml

sed -e "s/\[% name %\]/$name/g" src/${package_path}/controllers/Page2Controller.as |
sed -e "s/\[% package %\]/$package/g" > genius-tmp
mv genius-tmp src/${package_path}/controllers/Page2Controller.as
echo created ${output}${name}/src/${package_path}/controllers/Page2Controller.as

sed -e "s/\[% name %\]/$name/g" src/${package_path}/views/Page2.mxml |
sed -e "s/\[% package %\]/$package/g" > genius-tmp
mv genius-tmp src/${package_path}/views/Page2.mxml
echo created ${output}${name}/src/${package_path}/views/Page2.mxml

echo done.

exit